<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Gestion des Utilisateurs</title>
    <h:outputStylesheet>
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .container h1 {
            color: #1f2937;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        .container h3 {
            color: #374151;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .container button {
            background-color: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .container button:hover {
            background-color: #1d4ed8;
        }

        .container form {
            margin-bottom: 1.5rem;
        }

        .container table {
            width: 100%;
            border-collapse: collapse;
        }

        .container td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .container label {
            color: #374151;
            font-weight: 500;
            display: block;
            margin-bottom: 0.25rem;
        }

        .container input[type="text"],
        .container input[type="password"],
        .container select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
            margin-bottom: 1rem;
        }

        .container input[type="text"]:focus,
        .container input[type="password"]:focus,
        .container select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .user-table {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .user-table thead {
            background-color: #f3f4f6;
        }

        .user-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
        }

        .user-table td {
            padding: 1rem;
            color: #374151;
        }

        .user-table tr:hover {
            background-color: #f9fafb;
        }

        .user-table a {
            color: #dc2626;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .user-table a:hover {
            text-decoration: underline;
        }

        .error {
            background-color: #fee2e2;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 4px;
            margin-top: 1rem;
            border-left: 4px solid #dc2626;
        }

    </h:outputStylesheet>
</h:head>

<h:body>
    <!-- INCLURE LE HEADER -->
    <ui:include src="/views/includes/header.xhtml" />

    <div class="container">
        <h1>Gestion des Utilisateurs</h1>

        <!-- Bouton visible seulement pour l'admin -->
        <h:form rendered="#{userC.user.role eq 'ADMIN'}">
            <h:commandButton value="#{userC.showAddForm ? 'Masquer le formulaire' : 'Ajouter un utilisateur'}"
                             action="#{userC.toggleAddForm}">
                <f:ajax render="addForm" />
            </h:commandButton>
        </h:form>

        <!-- Bloc formulaire, affiché uniquement si showAddForm = true -->
        <h:panelGroup id="addForm" rendered="#{userC.showAddForm}">
            <h3>Ajouter un utilisateur</h3>
            <h:form>
                <h:panelGrid columns="2" cellpadding="5">
                    <h:outputLabel value="Username:" />
                    <h:inputText value="#{userC.user.username}" />

                    <h:outputLabel value="Email:" />
                    <h:inputText value="#{userC.user.email}" />

                    <h:outputLabel value="Mot de passe:" />
                    <h:inputSecret value="#{userC.user.password}" />

                    <h:outputLabel value="Rôle:" />
                    <h:selectOneMenu value="#{userC.user.role}">
                        <f:selectItem itemValue="CLIENT" itemLabel="Client" />
                        <f:selectItem itemValue="ADMIN" itemLabel="Administrateur" />
                    </h:selectOneMenu>

                    <h:panelGroup />
                    <h:commandButton value="Ajouter" action="#{userC.add}" />
                </h:panelGrid>
            </h:form>
        </h:panelGroup>

        <!-- Table des utilisateurs -->
        <h3>Liste des utilisateurs</h3>
        <h:form>
            <h:dataTable value="#{userC.users}" var="user" styleClass="user-table">
                <h:column>
                    <f:facet name="header">ID</f:facet>
                    #{user.id_user}
                </h:column>
                <h:column>
                    <f:facet name="header">Username</f:facet>
                    #{user.username}
                </h:column>
                <h:column>
                    <f:facet name="header">Email</f:facet>
                    #{user.email}
                </h:column>
                <h:column>
                    <f:facet name="header">Rôle</f:facet>
                    #{user.role}
                </h:column>
                <h:column>
                    <f:facet name="header">Actions</f:facet>
                    <h:commandLink value="Supprimer" action="#{userC.delete}">
                        <f:setPropertyActionListener target="#{userC.selectedUser}" value="#{user}" />
                    </h:commandLink>
                </h:column>
            </h:dataTable>
        </h:form>
    </div>
</h:body>
</html>
